geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'green', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'orange', linetype='twodash') +
scale_color_manual(values = c(ECOG_0="blue", ECOG_1="green", ECOG_2="orange"))
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0, fill='ECOG_0'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1, fill='ECOG_1'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2, fill='ECOG_2'), alpha=0.5) +
geom_vline(xintercept = diff.prop.survival.ECOG_0.empir, color='blue', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'darkgreen', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'orange', linetype='twodash') +
scale_color_manual(values = c('ECOG_0'='blue', 'ECOG_1'='green', 'ECOG_2'="orange"))
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0, fill='blue'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1, fill='darkgreen'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2, fill='orange'), alpha=0.5) +
geom_vline(xintercept = diff.prop.survival.ECOG_0.empir, color='blue', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'darkgreen', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'orange', linetype='twodash') +
scale_color_manual(values = c('ECOG_0'='blue', 'ECOG_1'='green', 'ECOG_2'="orange"))
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0), fill='blue', alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1), fill='darkgreen', alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2), fill='orange', alpha=0.5) +
geom_vline(xintercept = diff.prop.survival.ECOG_0.empir, color='blue', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'darkgreen', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'orange', linetype='twodash') +
scale_color_manual(values = c('ECOG_0'='blue', 'ECOG_1'='green', 'ECOG_2'="orange"))
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0), fill='red', alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1), fill='blue', alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2), fill='orange', alpha=0.5)
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0), fill='red', alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1), fill='green', alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2), fill='blue', alpha=0.5)
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0, fill='ECOG_0'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1, fill='ECOG_1'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2, fill='ECOG_2'), alpha=0.5) +
geom_vline(xintercept = diff.prop.survival.ECOG_0.empir, color='blue', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'darkgreen', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'orange', linetype='twodash') +
scale_color_manual(values = c('ECOG_0'='blue', 'ECOG_1'='green', 'ECOG_2'="orange"))
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0, fill='ECOG_0'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1, fill='ECOG_1'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2, fill='ECOG_2'), alpha=0.5) +
geom_vline(xintercept = diff.prop.survival.ECOG_0.empir, color='red', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'green', linetype='twodash') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'blue', linetype='twodash')
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0, fill='ECOG_0'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1, fill='ECOG_1'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2, fill='ECOG_2'), alpha=0.5) +
geom_vline(xintercept = diff.prop.survival.ECOG_0.empir, color='red') +
geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'green') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'blue')
ggplot() +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_0, fill='ECOG_0'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_1, fill='ECOG_1'), alpha=0.5) +
geom_density(data=permutated.diff_survival, aes(x=diff.survival.ECOG_2, fill='ECOG_2'), alpha=0.5) +
geom_vline(xintercept = diff.prop.survival.ECOG_0.empir, color='red') +
geom_vline(xintercept = diff.prop.survival.ECOG_1.empir, color = 'green') +
geom_vline(xintercept = diff.prop.survival.ECOG_2.empir, color = 'blue') +
ggtitle(label = 'Difference in proportion survive past 400 days for tx v. control in separate ECOG groups') +
xlab(label ='Difference in proportion survival past 400 days for tx v. control')
permutated.diff_survival
mean(permuted.diff_survival$diff.survival.ECOG_0 <= diff.prop.survival.ECOG_0.empir)
mean(permutated.diff_survival$diff.survival.ECOG_0 <= diff.prop.survival.ECOG_0.empir)
mean(permuated.diff_survival$diff.survival.ECOG_1 <= diff.prop.survival.ECOG_1.empir)
mean(permutated.diff_survival$diff.survival.ECOG_2 <= diff.prop.survival.ECOG_2.empir)
mean(permutated.diff_survival$diff.survival.ECOG_0 <= diff.prop.survival.ECOG_0.empir)
mean(permutated.diff_survival$diff.survival.ECOG_1 <= diff.prop.survival.ECOG_1.empir)
mean(permutated.diff_survival$diff.survival.ECOG_2 <= diff.prop.survival.ECOG_2.empir)
nsclc
nsclc[,age.onset:= round(age - (durdis/12), 2)]
nsclc
ggplot() +
geom_density(data=nsclc, aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_vline(xintercept=mean(nsclc[survival.past.400=='1']$age.onset), color='blue') +
geom_vline(xintercept=mean(nsclc[survival.past.400=='0']$age.onset), color='red')
ggplot(data=nsclc)+
geom_point(aes(x=age.onset, y=obstime))
ggplot(dta=nsclc)+
geom_boxplot(aes(x=suvival.poast.400, y=age.onset))
ggplot(data=nsclc)+
geom_boxplot(aes(x=suvival.poast.400, y=age.onset))
ggplot(data=nsclc)+
geom_boxplot(aes(x=suvival.past.400, y=age.onset))
ggplot(data=nsclc)+
geom_boxplot(aes(x=survival.past.400, y=age.onset))
ggplot(data=nsclc)+
geom_boxplot(aes(group=survival.past.400, y=age.onset))
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(survival.past.400), y=age.onset))
cor(x = nsclc$obstime, y = nsclc$age.onset, method = 'spearman')
cor(y = nsclc$obstime, x = nsclc$age.onset, method = 'spearman')
cor(y = nsclc$obstime, x = nsclc$age.onset)
ggplot(data=nsclc)+
geom_point(aes(x=age.onset, y=obstime)) +
geom_smooth(method = 'lm', se = FALSE)
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc)+
geom_point(aes(x=age.onset, y=obstime)) +
geom_smooth(method = 'lm', se = FALSE) +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=obstime))+
geom_point() +
geom_smooth(method = 'lm', se = FALSE) +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=obstime)) +
geom_point() +
geom_smooth(se = FALSE) +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=obstime)) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
cor.test(x = nsclc$obstime, y = nsclc$age.onset, method = 'spearman')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400)) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400, color=as.factor(tx))) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400)) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
nsclc
diff.mean.age.fn = function(data){
permutation <- sample(1:nrow(data), replace=FALSE)
permutation.data <- data
permutation.data$survival.past.400 = data$survival.past.400[permutation]
diff.mean.age.onset = mean(permutation.data[survival.past.400=='1']$age.onset) -
mean(permutation.data[survival.past.400=='0']$age.onset)
return(diff.mean.age.onset)
}
replicate(n = 10, expr = diff.mean.age.fn(nsclc))
t(replicate(n = 10, expr = diff.mean.age.fn(nsclc)))
as.data.table(t(replicate(n = 10, expr = diff.mean.age.fn(nsclc))))
t(as.data.table(replicate(n = 10, expr = diff.mean.age.fn(nsclc))))
t(replicate(n = 10, expr = diff.mean.age.fn(nsclc)))
(replicate(n = 10, expr = diff.mean.age.fn(nsclc)))
as.data.talbe(replicate(n = 10, expr = diff.mean.age.fn(nsclc)))
as.data.table(replicate(n = 10, expr = diff.mean.age.fn(nsclc)))
as.data.table(replicate(n = 10, expr = diff.mean.age.fn(nsclc)))
permuted.diff_mean.age.onset = as.data.table(replicate(n = 1000, expr = diff.mean.age.fn(nsclc)))
setnames(permuted.diff_mean.age.onset, c('diff.mean.age.onset'))
permuted.diff_mean.age.onset
diff_mean.age.onset.empir = mean(nsclc[survival.past.400=='1']$age.onset) -
mean(nsclc[survival.past.400=='0']$age.onset)
diff.mean.age.fn = function(data){
ggplot() +
geom_density(data=permuted.diff_mean.age.onset, aes(x=diff.mean.age.onset, fill=as.factor(grey), alpha=0.5))+
geom_vline(xintercept=diff_mean.age.onset.empir, color='blue') +
ggtitle(label = 'age of onset for each suvival outcome w/ calculated mean' )
ggplot() +
geom_density(data=permuted.diff_mean.age.onset, aes(x=diff.mean.age.onset), fill='grey', alpha=0.5)+
geom_vline(xintercept=diff_mean.age.onset.empir, color='blue') +
ggtitle(label = 'age of onset for each suvival outcome w/ calculated mean' )
mean(permuted.diff_mean.age.onset$diff.mean.age.onset <= diff_mean.age.onset.empir)
ggplot(data=nsclc, aes(x=age.onset, y=obstime, fill.as.factor(tx))) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=obstime, fill=as.factor(tx))) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=obstime, color=as.factor(tx))) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400, color=as.factor(tx))) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(survival.past.400), y=age.onset, fill=as.factor(tx))) +
xlab(label = 'suvival.past.400') +
ggtitle('age of onset v. suvival past 400 days')
nsclc[tx=='1' && survival.past.400=='1']
nsclc[tx=='1' & survival.past.400=='1']
ggplot() +
geom_density(data=nsclc[tx=='1'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_density(data=nsclc[tx=='0'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='1']$age.onset), color='blue') +
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset), color='blue', linetype='dash') +
geom_vline(xintercept=mean(nsclc[tx=='0' & survival.past.400=='1']$age.onset), color='red') +
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset), color='red', linetype='dash) +
ggplot() +
geom_density(data=nsclc[tx=='1'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_density(data=nsclc[tx=='0'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='1']$age.onset), color='blue') +
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset), color='blue', linetype='dash') +
geom_vline(xintercept=mean(nsclc[tx=='0' & survival.past.400=='1']$age.onset), color='red') +
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset), color='red', linetype='dash')
ggplot() +
geom_density(data=nsclc[tx=='1'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_density(data=nsclc[tx=='0'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))
ggplot() +
geom_density(data=nsclc[tx=='1'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_density(data=nsclc[tx=='0'], aes(x=age.onset, fill=as.factor(survival.past.400)+10, alpha=0.5))
ggplot() +
geom_density(data=nsclc[tx=='1'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_density(data=nsclc[tx=='0'], aes(x=age.onset, fill=as.factor(survival.past.400+10), alpha=0.5))
ggplot() +
geom_density(data=nsclc[tx=='1'], aes(x=age.onset, fill=as.factor(survival.past.400), alpha=0.5))+
geom_density(data=nsclc[tx=='0'], aes(x=age.onset, fill=as.factor(survival.past.400+10), alpha=0.5))+
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='1']$age.onset), color='blue') +
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset), color='blue', linetype='dash') +
geom_vline(xintercept=mean(nsclc[tx=='0' & survival.past.400=='1']$age.onset), color='red') +
geom_vline(xintercept=mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset), color='red', linetype='dash')
diff_mean.age.onset.TX.empir = mean(nsclc[tx=='1' & survival.past.400=='1']$age.onset) -
mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset)
diff_mean.age.onset.CT.empir = mean(nsclc[tx=='0' & survival.past.400=='1']$age.onset) -
mean(nsclc[tx=='0' & survival.past.400=='0']$age.onset)
diff_mean.age.onset.TX.empir
diff_mean.age.onset.CT.empir
median(nsclc[tx=='1' & survival.past.400=='1']$age.onset) -
median(nsclc[tx=='1' & survival.past.400=='0']$age.onset)
median(nsclc[tx=='0' & survival.past.400=='1']$age.onset) -
median(nsclc[tx=='0' & survival.past.400=='0']$age.onset)
diff_median.age.onset.TX.empir = median(nsclc[tx=='1' & survival.past.400=='1']$age.onset) -
median(nsclc[tx=='1' & survival.past.400=='0']$age.onset)
diff_median.age.onset.CT.empir = median(nsclc[tx=='0' & survival.past.400=='1']$age.onset) -
median(nsclc[tx=='0' & survival.past.400=='0']$age.onset)
ggplot(data=nsclc, aes(y=age.onset, x=survival.past.400, color=as.factor(tx))) +
ggplot(data=nsclc)+
geom_boxplot(aes(y=as.factor(survival.past.400), x=age.onset, fill=as.factor(tx))) +
xlab(label = 'suvival.past.400') +
ggtitle('age of onset v. suvival past 400 days')
ggplot(data=nsclc)+
geom_boxplot(aes(y=as.factor(survival.past.400), x=age.onset, fill=as.factor(tx)))
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(survival.past.400), y=age.onset, fill=as.factor(tx))) +
xlab(label = 'suvival.past.400') +
coord_flip() +
ggtitle('age of onset v. suvival past 400 days')
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(survival.past.400), y=age.onset, fill=as.factor(tx))) +
xlab(label = 'suvival.past.400') +
ggtitle('age of onset v. suvival past 400 days')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400, color=as.factor(tx))) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400, color=as.factor(tx))) +
geom_point() +
geom_smooth(method = 'lm') +
ggtitle('age of onset v. suvival time')
cor.test(y = nsclc$survival.past.400, x = nsclc$age.onset, method = 'spearman')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400)) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400)) +
geom_point() +
geom_smooth(method='lm') +
ggtitle('age of onset v. suvival time')
cor.test(y = nsclc$survival.past.400, x = nsclc$age.onset, method = 'spearman')
cor.test(y = nsclc$survival.past.400, x = nsclc$age.onset, method = 'pearson')
cor.test(y = nsclc$survival.past.400, x = nsclc$age.onset, method = 'spearman')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400)) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival time')
cor.test(y = nsclc$survival.past.400, x = nsclc$age.onset, method = 'spearman')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400, color=as.factor(tx))) +
geom_point() +
geom_smooth(method = 'lm') +
ggtitle('age of onset v. suvival time')
cor.test(x = nsclc[tx=='1']$age.onset, y = nsclc$survival.past.400, method = 'spearman')
cor.test(x = nsclc[tx=='1']$age.onset, y = nsclc[tx=='1']$survival.past.400, method = 'spearman')
cor.test(x = nsclc[tx=='0']$age.onset, y = nsclc[tx=='0']$survival.past.400, method = 'spearman')
fit.null = lm(as.numeric(survival.past.400) ~ 1, data = nsclc)
fir.null
fir.null
fit.null
fit.ao = lm(as.numeric(survival.past.400) ~ age.onset, data=nsclc)
fir.ao
fit.ao
resids.null = as.numeric(nsclc$survival.past.400) - predict(fit.null)
resids.ao = as.numeric(nsclc$survival.past.400) - predict(fit.ao)
MSE = mean(resids.ao^2) / mean(resids.null^2)
MSE
fit.ao.smooth = loess(as.numeric(survival.past.400) ~ age.onset, data=nsclc)
resids.ao.smooth = as.numeric(nsclc$survival.past.400) - predict(fit.ao.smooth)
mean(resids.ao.smooth^2) / mean(resids.null^2)
MSE_ratio.fn = function(dt){
permutation <- sample(1:nrow(dt), replace=FALSE)
permutation.data <- dt
permutation.data$survival.past.400 = data$survival.past.400[permutation]
fit.null = lm(as.numeric(survival.past.400) ~ 1, data = permutation.data)
fit.ao.smooth = loess(as.numeric(survival.past.400) ~ age.onset, data = permutation.data)
resids.null = as.numeric(nsclc$survival.past.400) - predict(fit.null)
resids.ao.smooth = as.numeric(nsclc$survival.past.400) - predict(fit.ao.smooth)
MSE.ratio = mean(resids.ao.smooth^2) / mean(resids.null^2)
return(MSE.ratio)
}
MSE.ratio.empir = mean(resids.ao.smooth^2) / mean(resids.null^2)
as.data.table(replicate(n = 10, expr = MSE_ratio.fn(nsclc)))
replicate(n = 10, expr = MSE_ratio.fn(nsclc))
MSE_ratio.fn(nsclc)
MSE_ratio.fn = function(dt){
permutation <- sample(1:nrow(dt), replace=FALSE)
permutation.data <- dt
permutation.data$survival.past.400 = dt$survival.past.400[permutation]
fit.null = lm(as.numeric(survival.past.400) ~ 1, data = permutation.data)
fit.ao.smooth = loess(as.numeric(survival.past.400) ~ age.onset, data = permutation.data)
resids.null = as.numeric(nsclc$survival.past.400) - predict(fit.null)
resids.ao.smooth = as.numeric(nsclc$survival.past.400) - predict(fit.ao.smooth)
MSE.ratio = mean(resids.ao.smooth^2) / mean(resids.null^2)
return(MSE.ratio)
}
MSE_ratio.fn(nsclc)
as.data.table(replicate(n = 10, expr = MSE_ratio.fn(nsclc)))
permuted.MSE_ratio.age.onset = as.data.table(replicate(n = 1000, expr = MSE_ratio.fn(nsclc)))
setnames(permuted.MSE_ratio.age.onset, c('MSE.ratio.age.onset'))
mean(permuted.MSE_ratio.age.onset$MSE.ratio.age.onset >= MSE.ratio.empir)
mean(permuted.MSE_ratio.age.onset$MSE.ratio.age.onset <= MSE.ratio.empir)
ggplot() +
geom_density(data=permuted.MSE_ratio.age.onset, aes(x=MSE.ratio.age.onset), fill='grey', alpha=0.5)
ggplot() +
geom_density(data=permuted.MSE_ratio.age.onset, aes(x=MSE.ratio.age.onset), fill='grey', alpha=0.5)+
geom_vline(xintercept=MSE.ratio.empir, color='blue')
fit.null = lm(as.numeric(survival.past.400) ~ 1, data = nsclc)
fit.ao = lm(as.numeric(survival.past.400) ~ age.onset, data=nsclc)
fit.ao.smooth = loess(as.numeric(survival.past.400) ~ age.onset, data=nsclc)
resids.null = as.numeric(nsclc$survival.past.400) - predict(fit.null)
resids.ao = as.numeric(nsclc$survival.past.400) - predict(fit.ao)
resids.ao.smooth = as.numeric(nsclc$survival.past.400) - predict(fit.ao.smooth)
MSE.ratio.empir = mean(resids.ao^2) / mean(resids.null^2)
MSE_ratio.fn = function(dt){
permutation <- sample(1:nrow(dt), replace=FALSE)
permutation.data <- dt
permutation.data$survival.past.400 = dt$survival.past.400[permutation]
fit.null = lm(as.numeric(survival.past.400) ~ 1, data = permutation.data)
fit.ao.smooth = lm(as.numeric(survival.past.400) ~ age.onset, data = permutation.data)
resids.null = as.numeric(nsclc$survival.past.400) - predict(fit.null)
resids.ao.smooth = as.numeric(nsclc$survival.past.400) - predict(fit.ao.smooth)
MSE.ratio = mean(resids.ao.smooth^2) / mean(resids.null^2)
return(MSE.ratio)
}
permuted.MSE_ratio.age.onset = as.data.table(replicate(n = 1000, expr = MSE_ratio.fn(nsclc)))
setnames(permuted.MSE_ratio.age.onset, c('MSE.ratio.age.onset'))
ggplot() +
geom_density(data=permuted.MSE_ratio.age.onset, aes(x=MSE.ratio.age.onset), fill='grey', alpha=0.5)+
geom_vline(xintercept=MSE.ratio.empir, color='blue') +
ggtitle(label = 'age of onset for each suvival outcome w/ calculated mean' )
mean(permuted.MSE_ratio.age.onset$MSE.ratio.age.onset <= MSE.ratio.empir)
fit.null = glm(as.numeric(survival.past.400) ~ 1, data = nsclc, family = 'binomial')
fit.ao = glm(as.numeric(survival.past.400) ~ age.onset, data=nsclc, family = 'binomial')
resids.null = as.numeric(nsclc$survival.past.400) - predict(fit.null)
resids.ao = as.numeric(nsclc$survival.past.400) - predict(fit.ao)
MSE.ratio.empir = mean(resids.ao^2) / mean(resids.null^2)
MSE.ratio.empir
as.numeric(nsclc$survival.past.400) - predict(fit.null)
as.numeric(nsclc$survival.past.400) - predict(fit.ao)
MSE_ratio.fn = function(dt){
permutation <- sample(1:nrow(dt), replace=FALSE)
permutation.data <- dt
permutation.data$survival.past.400 = dt$survival.past.400[permutation]
fit.null = glm(as.numeric(survival.past.400) ~ 1, data = permutation.data, family='binomial')
fit.ao = glm(as.numeric(survival.past.400) ~ age.onset, data = permutation.data, family='binomial')
resids.null = as.numeric(nsclc$survival.past.400) - predict(fit.null)
resids.ao.smooth = as.numeric(nsclc$survival.past.400) - predict(fit.ao)
MSE.ratio = mean(resids.ao^2) / mean(resids.null^2)
return(MSE.ratio)
}
permuted.MSE_ratio.age.onset = as.data.table(replicate(n = 1000, expr = MSE_ratio.fn(nsclc)))
setnames(permuted.MSE_ratio.age.onset, c('MSE.ratio.age.onset'))
ggplot() +
geom_density(data=permuted.MSE_ratio.age.onset, aes(x=MSE.ratio.age.onset), fill='grey', alpha=0.5)+
geom_vline(xintercept=MSE.ratio.empir, color='blue') +
ggtitle(label = 'age of onset for each suvival outcome w/ calculated mean' )
permuted.MSE_ratio.age.onset
nsclc
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400)) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival status')
cor.test(y = nsclc$survival.past.400, x = nsclc$age.onset, method = 'spearman')
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(survival.past.400), y=age.onset)) +
xlab(label = 'suvival.past.400') +
ggtitle('age of onset v. suvival past 400 days')
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(survival.past.400), y=age.onset, fill=as.factor(tx))) +
xlab(label = 'suvival.past.400') +
ggtitle('age of onset v. suvival past 400 days')
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(tx), y=age.onset, fill=as.factor(survival.past.400))) +
xlab(label = 'suvival.past.400') +
ggtitle('age of onset v. suvival past 400 days')
ggplot(data=nsclc)+
geom_boxplot(aes(x=as.factor(tx), y=age.onset, fill=as.factor(survival.past.400))) +
xlab(label = 'treatment status') +
ggtitle('age of onset v. suvival past 400 days')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400, color=as.factor(tx))) +
geom_point() +
geom_smooth(method = 'lm') +
ggtitle('age of onset v. suvival status')
cor.test(x = nsclc[tx=='1']$age.onset, y = nsclc[tx=='1']$survival.past.400, method = 'spearman')
cor.test(x = nsclc[tx=='0']$age.onset, y = nsclc[tx=='0']$survival.past.400, method = 'spearman')
ggplot(data=nsclc, aes(x=age.onset, y=survival.past.400, color=as.factor(tx))) +
geom_point() +
geom_smooth() +
ggtitle('age of onset v. suvival status')
cor.test(x = nsclc[tx=='1']$age.onset, y = nsclc[tx=='1']$survival.past.400, method = 'spearman')
cor.test(x = nsclc[tx=='0']$age.onset, y = nsclc[tx=='0']$survival.past.400, method = 'spearman')
diff.median.age.treat.fn = function(data){
permutation.TX <- sample(1:nrow(filter(data, tx==1)), replace=FALSE)
permutation.CT <- sample(1:nrow(filter(data, tx==0)), replace=FALSE)
permutation.data.TX <- filter(data, tx==1)
permutation.data.CT <- filter(data, tx==0)
permutation.data.TX$survival.past.400 = permutation.data.TX$survival.past.400[permutation.TX]
permutation.data.CT$survival.past.400 = permutation.data.CT$survival.past.400[permutation.CT]
permuted.data = rbind(permutation.data.TX, permutation.data.CT)
diff.median.age.onset.TX = median(permuted.data[tx=='1' & survival.past.400=='1']$age.onset) -
median(permuted.data[tx=='1' & survival.past.400=='0']$age.onset)
diff.median.age.onset.CT = median(permuted.data[tx=='0' & survival.past.400=='1']$age.onset) -
median(permuted.data[tx=='0' & survival.past.400=='0']$age.onset)
return(c(diff.median.age.onset.TX, diff.median.age.onset.CT))
}
as.data.table(replicate(n = 10, expr = diff.median.age.treat.fn(nsclc)))
t(as.data.table(replicate(n = 10, expr = diff.median.age.treat.fn(nsclc))))
as.data.table(t(replicate(n = 10, expr = diff.median.age.treat.fn(nsclc))))
setnames(permuted.diff_mean.age.onset, c('diff.mean.age.onset'))
setnames(permuted.diff_median.age.onset.treat, c('diff.median.age.onset.TX', 'diff.median.age.onset.CT'))
permuted.diff_median.age.onset.treat = as.data.table(t(replicate(n = 10, expr = diff.median.age.treat.fn(nsclc))))
setnames(permuted.diff_median.age.onset.treat, c('diff.median.age.onset.TX', 'diff.median.age.onset.CT'))
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX), fill='grey', alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT), fill='grey', alpha=0.5)
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX), fill='blue', alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT), fill='orange', alpha=0.5)
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX), fill='blue', alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT), fill='orange', alpha=0.5) +
geom_vline(xintercept=diff_median.age.onset.TX.empir, color='blue') +
geom_vline(xintercept=diff_median.age.onset.CT.empir, color='orange')
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX, fill='TX'), alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT, fill='CT'), alpha=0.5) +
geom_vline(xintercept=diff_median.age.onset.TX.empir, color='blue') +
geom_vline(xintercept=diff_median.age.onset.CT.empir, color='orange')
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX, fill='TX'), alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT, fill='CT'), alpha=0.5) +
geom_vline(xintercept=diff_median.age.onset.TX.empir, color='blue') +
geom_vline(xintercept=diff_median.age.onset.CT.empir, color='red')
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX, fill='TX'), alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT, fill='CT'), alpha=0.5) +
geom_vline(xintercept=diff_median.age.onset.TX.empir, color='blue') +
geom_vline(xintercept=diff_median.age.onset.CT.empir, color='red') +
ggtitle(label = 'Difference in median age of onset for suvival outcome stratified by treatment status' )
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX, fill='TX'), alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT, fill='CT'), alpha=0.5) +
geom_vline(xintercept=diff_median.age.onset.TX.empir, color='blue') +
geom_vline(xintercept=diff_median.age.onset.CT.empir, color='red') +
xlab('difference in median age of onset btwn survivors and non-survivors) +
ggtitle(label = 'Difference in median age of onset for suvival outcome stratified by treatment status' )
ggplot() +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.TX, fill='TX'), alpha=0.5) +
geom_density(data=permuted.diff_median.age.onset.treat, aes(x=diff.median.age.onset.CT, fill='CT'), alpha=0.5) +
geom_vline(xintercept=diff_median.age.onset.TX.empir, color='blue') +
geom_vline(xintercept=diff_median.age.onset.CT.empir, color='red') +
xlab('difference in median age of onset btwn survivors and non-survivors') +
ggtitle(label = 'Difference in median age of onset for suvival outcome stratified by treatment status' )
median(nsclc[tx=='1' & survival.past.400=='1']$age.onset) -
median(nsclc[tx=='1' & survival.past.400=='0']$age.onset)
median(nsclc[tx=='0' & survival.past.400=='1']$age.onset) -
median(nsclc[tx=='0' & survival.past.400=='0']$age.onset)
mean(permuted.diff_median.age.onset.treat$diff.median.age.onset.TX <= diff_median.age.onset.TX.empir)
mean(permuted.diff_median.age.onset.treat$diff.median.age.onset.CT <= diff_median.age.onset.CT.empir)
diff_mean.age.onset.TX.empir = mean(nsclc[tx=='1' & survival.past.400=='1']$age.onset) -
mean(nsclc[tx=='1' & survival.past.400=='0']$age.onset)
diff_mean.age.onset.CT.empir = mean(nsclc[tx=='0' & survival.past.400=='1']$age.onset) -
mean(nsclc[tx=='0' & survival.past.400=='0']$age.onset)
diff.mean.age.treat.fn = function(data){
permutation.TX <- sample(1:nrow(filter(data, tx==1)), replace=FALSE)
permutation.CT <- sample(1:nrow(filter(data, tx==0)), replace=FALSE)
permutation.data.TX <- filter(data, tx==1)
permutation.data.CT <- filter(data, tx==0)
permutation.data.TX$survival.past.400 = permutation.data.TX$survival.past.400[permutation.TX]
permutation.data.CT$survival.past.400 = permutation.data.CT$survival.past.400[permutation.CT]
permuted.data = rbind(permutation.data.TX, permutation.data.CT)
diff.mean.age.onset.TX = mean(permuted.data[tx=='1' & survival.past.400=='1']$age.onset) -
mean(permuted.data[tx=='1' & survival.past.400=='0']$age.onset)
diff.mean.age.onset.CT = mean(permuted.data[tx=='0' & survival.past.400=='1']$age.onset) -
mean(permuted.data[tx=='0' & survival.past.400=='0']$age.onset)
return(c(diff.mean.age.onset.TX, diff.mean.age.onset.CT))
}
permuted.diff_mean.age.onset.treat = as.data.table(t(replicate(n = 10, expr = diff.mean.age.treat.fn(nsclc))))
setnames(permuted.diff_mean.age.onset.treat, c('diff.mean.age.onset.TX', 'diff.mean.age.onset.CT'))
ggplot() +
geom_density(data=permuted.diff_mean.age.onset.treat, aes(x=diff.mean.age.onset.TX, fill='TX'), alpha=0.5) +
geom_density(data=permuted.diff_mean.age.onset.treat, aes(x=diff.mean.age.onset.CT, fill='CT'), alpha=0.5) +
geom_vline(xintercept=diff_mean.age.onset.TX.empir, color='blue') +
geom_vline(xintercept=diff_mean.age.onset.CT.empir, color='red') +
xlab('difference in mean age of onset btwn survivors and non-survivors') +
ggtitle(label = 'Difference in mean age of onset for suvival outcome stratified by treatment status' )
mean(permuted.diff_mean.age.onset.treat$diff.mean.age.onset.TX <= diff_mean.age.onset.TX.empir)
mean(permuted.diff_mean.age.onset.treat$diff.mean.age.onset.CT <= diff_mean.age.onset.CT.empir)
nsclc[,age.onset:= round(age - (durdis/12), 2)]
